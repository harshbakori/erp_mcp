<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Visualizer</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        #diagram { border: 1px solid #eee; padding: 20px; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>Project Architecture Diagram</h1>
    <div id="diagram">
        <div class="mermaid">
            Loading diagram...
        </div>
    </div>
    <p>This diagram is generated automatically from <code>architecture.json</code>.</p>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: false });

        async function renderDiagram() {
            try {
                const response = await fetch('architecture.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // Group nodes by their "group" property
                const groups = data.nodes.reduce((acc, node) => {
                    (acc[node.group] = acc[node.group] || []).push(node);
                    return acc;
                }, {});

                let mermaidSyntax = 'graph TD;\n';

                // Create subgraph blocks
                for (const groupName in groups) {
                    mermaidSyntax += `    subgraph "${groupName}";\n`;
                    groups[groupName].forEach(node => {
                        // Mermaid syntax: id["label"]
                        mermaidSyntax += `        ${node.id}["${node.label}"];\n`;
                    });
                    mermaidSyntax += '    end;\n';
                }

                // Add edges
                data.edges.forEach(edge => {
                    mermaidSyntax += `    ${edge.from} --> ${edge.to};\n`;
                });

                const diagramContainer = document.querySelector('.mermaid');
                const { svg } = await mermaid.render('graphDiv', mermaidSyntax);
                diagramContainer.innerHTML = svg;

            } catch (error) {
                console.error('Error fetching or rendering diagram:', error);
                document.querySelector('.mermaid').innerHTML = 'Failed to load diagram. See console for details.';
            }
        }

        renderDiagram();
    </script>
</body>
</html>